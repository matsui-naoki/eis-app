# EIS Analyzer

**電気化学インピーダンス分光法（EIS）解析Webアプリケーション**

PythonとStreamlitで構築されたブラウザベースのEIS解析ツール

**デモサイト:** https://eis-analyzer.streamlit.app

---

## 特徴

- **複数の解析モード**: Nyquist、Arrhenius、Mapping解析
- **インタラクティブな可視化**: Plotlyによる対話的なNyquist図、Bode線図、Arrhenius図
- **高度な回路フィッティング**: 標準フィット、ベイズ最適化、モンテカルロ、オートフィット、バッチ処理
- **マッピング解析**: 1D、2Dヒートマップ、三元系ダイアグラム
- **セッション管理**: 解析セッションの保存・読み込み
- **エクスポート機能**: Igor Pro (.itx)、CSV、JSON

---

## クイックスタート（ローカル実行）

```bash
pip install -r requirements.txt
streamlit run app.py
```

---

## 対応ファイル形式

| 形式 | 拡張子 | 測定器 |
|------|--------|--------|
| BioLogic EC-Lab | .mpt | BioLogic |
| ZPlot | .z | Scribner |
| Gamry | .dta | Gamry Instruments |
| Keysight | .par | Keysight |
| テキスト/CSV | .txt, .csv, .dat | 汎用 |

---

## 使い方

### 1. サンプル情報の入力

サイドバーでサンプルパラメータを入力:
- **Sample Name**: サンプル名
- **Thickness**: 試料厚さ (cm)
- **Diameter/Area**: 電極の直径または面積

### 2. データの読み込み

サイドバーの**Upload**ボタンからEISデータファイルを読み込みます。複数ファイルの同時読み込みが可能です。

### 3. 解析モード

サイドバーから解析モードを選択:

#### Nyquistモード
- Nyquist図（Z' vs -Z''）とBode線図の表示
- 等価回路フィッティング
- 単一または複数ファイルの解析

#### Arrheniusモード
- 温度依存性解析
- log(σT) vs 1000/T プロット
- 傾きから活性化エネルギーを算出

#### Mappingモード
- **1D**: 位置 vs 伝導率
- **2D**: 空間ヒートマップ（補間機能付き）
- **Ternary**: 三成分組成図

### 4. 等価回路フィッティング

#### 回路モデルの選択
25種類以上のプリセット回路から選択、またはカスタム回路を入力:
- `p(R1,CPE1)-CPE2` - 単一半円＋スパイク
- `p(R1,CPE1)-p(R2,CPE2)-CPE3` - 2つの半円＋スパイク
- `R1-p(R2-W1,CPE1)` - Randles回路

#### フィッティング手法

| 手法 | 説明 |
|------|------|
| **Fit** | 標準的な最小二乗フィッティング |
| **Bayesian** | Optunaによるグローバル最適化 |
| **MC Fit** | ノイズ注入によるモンテカルロ法 |
| **Auto Fit** | Bayesian + Monte Carloの組み合わせ |
| **Batch** | 複数ファイルの連続処理 |

#### 重み付けオプション
- **None**: 全点に等しい重み
- **Proportional**: |Z|で重み付け（低周波側を強調）
- **Modulus**: 1/|Z|で重み付け（高周波側を強調）

### 5. データ範囲の制御

| 制御項目 | 用途 |
|----------|------|
| **Display Range** | プロットに表示するデータ点 |
| **Fitting Range** | フィッティングに使用するデータ点 |
| **Delete Points** | 特定のインデックスを除外（例: `0,5,10` または `5:10`） |

**適用モード**:
- **Global**: 全ファイルに同じ範囲を適用
- **Individual**: ファイルごとに個別の範囲を設定

### 6. プロットのカスタマイズ

**Settings**タブで設定:
- マーカー: 色、シンボル、サイズ、透明度、枠線スタイル
- フィット曲線: 色、線幅
- 軸: ラベルフォントサイズ、目盛りフォントサイズ
- 凡例: 位置、フォントサイズ、表示モード
- ゼロ線: 表示/非表示

### 7. データのエクスポート

#### セッション保存/読み込み
- **Save**: 完全なセッションをJSONにエクスポート
- **Load**: 以前のセッションを復元

#### Igor Pro エクスポート
- データとフィット結果を.itx形式でエクスポート
- 軸書式設定用のプロシージャファイル(.ipf)付き

#### CSVエクスポート
- サマリーテーブルのダウンロード
- 個別ファイルデータのエクスポート

---

## 等価回路の記法

[impedance.py](https://impedancepy.readthedocs.io/)の記法を使用:

| 記号 | 素子 | パラメータ |
|------|------|------------|
| R | 抵抗 | R (Ω) |
| C | コンデンサ | C (F) |
| CPE | 定位相角素子 | Q (F·s^(n-1)), n |
| W | Warburg | Aw |
| L | インダクタ | L (H) |

**演算子**:
- `-` : 直列接続
- `p(A,B)` : 並列接続

**例**:
```
R1-CPE1                    # RとCPEの直列
p(R1,CPE1)                 # RとCPEの並列
p(R1,CPE1)-p(R2,CPE2)      # 2つのRC並列回路の直列
R1-p(R2-W1,CPE1)           # Randles回路
```

---

## 解析結果

### 多点解析テーブル

全フィッティングデータのサマリー:
- 温度 (K)
- フィッティングパラメータ (R, CPE_Q, CPE_α)
- 伝導率 (σ, log(σ), σT, log(σT))
- 有効容量 (C_eff)
- RMSPE（品質指標）

### RMSPEの解釈

| RMSPE | 品質 |
|-------|------|
| < 1% | 優秀 |
| 1-3% | 良好 |
| 3-5% | 許容範囲 |
| > 5% | 要改善 |

---

## 操作方法

Plotlyの標準操作:
- **スクロール**: ズームイン/アウト
- **ドラッグ**: パン（移動）
- **ダブルクリック**: 表示リセット
- **ホバー**: データツールチップ表示

---

## Tips

1. **初期値**: 適切な初期値を設定するとフィッティングの収束が向上
2. **フィッティング範囲**: ノイズの多い高周波/低周波領域を除外
3. **重み付け方法**: 固体電解質には "Proportional" が有効
4. **ベイズフィット**: 複雑な回路では試行回数を増やす
5. **バッチフィット**: 温度連続データには "Use previous result" を有効に

---

## 必要環境

- Python 3.8+
- streamlit
- numpy
- pandas
- scipy
- plotly
- impedance

オプション:
- optuna（ベイズ最適化用）

---

## ライセンス

研究・教育目的での使用が可能です。

---

## 謝辞

- [impedance.py](https://impedancepy.readthedocs.io/) - 回路モデリング
- [Streamlit](https://streamlit.io/) - Webフレームワーク
- [Plotly](https://plotly.com/python/) - インタラクティブプロット
- [Optuna](https://optuna.org/) - ベイズ最適化

---

**Created with Claude Code**
